<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>true • oro.nifti</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="true">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oro.nifti</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.9.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/nifti2.html">Working with the NIfTI Data Standard in \proglang{R}</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>true</h1>
                        <h4 class="author">Brandon Whitcher</h4>
            <address class="author_afil">
      Pfizer Worldwide R&amp;D<br><h4 class="author">Volker J. Schmid</h4>
            <address class="author_afil">
      Ludwig-Maximilians Universit"at M"unchen<br><h4 class="author">Andrew Thornton</h4>
            <address class="author_afil">
      Cardiff University<br><div class="hidden name"><code>nifti2.Rmd</code></div>

    </address>
</address>
</address>
</div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      The package  facilitates the interaction with and manipulation of medical imaging data that conform to the ANALYZE, NIfTI and AFNI formats. The 4 class framework is used to develop basic ANALYZE and NIfTI classes, where NIfTI extensions may be used to extend the fixed-byte NIfTI header. One example of this, that has been implemented, is an -based “audit trail” tracking the history of operations applied to a data set. The conversion from DICOM to ANALYZE/NIfTI is straightforward using the capabilities of . The 4 classes have been developed to provide a user-friendly interface to the ANALYZE/NIfTI data formats; allowing easy data input, data output, image processing and visualization.
    </div>
    
<pre><code>## oro.nifti 0.9.11</code></pre>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Medical imaging is well established in both the clinical and research areas with numerous equipment manufacturers supplying a wide variety of modalities. The ANALYZE format was developed at the Mayo Clinic (in the 1990s) to store multidimensional biomedical images. It is fundamentally different from the DICOM standard since it groups all images from a single acquisition (typically three- or four-dimensional) into a pair of binary files, one containing header information and one containing the image information. The DICOM standard groups the header and image information, typically a single two-dimensional image, into a single file. Hence, a single acquisition will contain multiple DICOM files but only a pair of ANALYZE files.</p>
<p>The NIfTI format was developed in the early 2000s by the DFWG (Data Format Working Group) in an effort to improve upon the ANALYZE format. The resulting NIfTI-1 format adheres to the basic header/image combination from the ANALYZE format, but allows the pair of files to be combined into a single file and re-defines the header fields. In addition, NIfTI extensions allow one to store additional information (e.g., key acquisition parameters, experimental design) inside a NIfTI file.</p>

<p>The material presented here provides users with a method of interacting with ANALYZE and NIfTI files in  . Real-world data sets, that are publicly available, are used to illustrate the basic functionality of  . It should be noted that  focuses on functions for data input/output and visualization. 4 classes  and  are provided for further statistical analysis in  without losing contextual information from the original ANALYZE or NIfTI files. Images in the metadata-rich DICOM format may be converted to NIfTI semi-automatically using  by utilizing as much information from the DICOM files as possible. Basic visualization functions, similar to those commonly used in the medical imaging community, are provided for  and  objects. Additionally, the  package allows one to track every operation on a  object in an -based audit trail.</p>
<p>The  package should appeal not only to  package developers, but also to scientists and researchers who want to interrogate medical imaging data using the statistical capabilities of  without writing and validating their own basic data input/output functionality. Table~ lists the key functions for  and groups them according to common functionality. An example of using statistical methodology in  for the analysis of functional magnetic resonance imaging (fMRI) data is given in section~. Packages already available on CRAN that utilize  include:  ,  ,  , and  .</p>

Although the industry standard for medical imaging data is DICOM, another format has come to be heavily used in the image analysis community. The ANALYZE format was originally developed in conjunction with an image processing system (of the same name) at the Mayo Foundation. A common version of the format, although not the most recent, is called ANALYZE 7.5. A copy of the file ANALYZE75.pdf has been included in  (accessed via ) since it does not appear to be available from  any longer. An ANALYZE 7.5 format image is comprised of two files, the “.hdr” and “.img” files, that contain information about the acquisition and the acquisition itself, respectively. A more recent adaption of this format is known as NIfTI-1 and is a product of the Data Format Working Group (DFWG) from the Neuroimaging Informatics Technology Initiative (NIfTI; ). The NIfTI-1 data format is almost identical to the ANALYZE format, but offers a few improvements

<p>There are several  packages that also offer input/output functionality for the NIfTI and ANALYZE data formats in addition to image analysis capabilities for specific MRI acquisition sequences; e.g.,  ,   and  . The  package provides access to NIfTI data via the  library .</p>

<p>The NIfTI header inherits its structure (348 bytes in length) from the ANALYZE data format. The last four bytes in the NIfTI header correspond to the “magic” field and denote whether or not the header and image are contained in a single file () or two separate files (), the latter being identical to the structure of the ANALYZE data format. The NIfTI data format added an additional four bytes to allow for “extensions” to the header. By default these four bytes are set to zero.</p>
<p>The first example of reading in, and displaying, medical imaging data in NIfTI format  was obtained from the NIfTI website (). Successful execution of the commands</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">fname &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="kw">file.path</span>(<span class="st">"nifti"</span>, <span class="st">"mniLR.nii.gz"</span>), <span class="dt">package=</span><span class="st">"oro.nifti"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">(mniLR &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_nifti.html">readNIfTI</a></span>(fname))</a></code></pre></div>
<pre><code>## NIfTI-1 format
##   Type            : niftiAuditTrail
##   Data Type       : 2 (UINT8)
##   Bits per Pixel  : 8
##   Slice Code      : 0 (Unknown)
##   Intent Code     : 0 (None)
##   Qform Code      : 0 (Unknown)
##   Sform Code      : 4 (MNI_152)
##   Dimension       : 91 x 109 x 91
##   Pixel Dimension : 2 x 2 x 2
##   Voxel Units     : mm
##   Time Units      : sec</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/pixdim-methods.html">pixdim</a></span>(mniLR)</a></code></pre></div>
<pre><code>## [1] 0 2 2 2 1 1 1 1</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/descrip-methods.html">descrip</a></span>(mniLR)</a></code></pre></div>
<pre><code>## [1] "FSL3.2beta"</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/aux_file-methods.html">aux.file</a></span>(mniLR)</a></code></pre></div>
<pre><code>## [1] "none                   "</code></pre>
<p>produces an 4  object (or  if the audit trail option is set). Some accessor functions are also provided; e.g.,  and . The former is used to access the original name of the file (if it has been provided) and the latter is the name of a valid NIfTI header field used to hold a “description” (up to 80 characters in length).</p>

<p>Image information begins at the byte position determined by the  slot. In a single NIfTI file (), this is by default after the first 352 bytes. Header extensions extend the size of the header and come before the image information leading to a consequent increase of  for single NIfTI files. The split NIfTI () and ANALYZE formats contain pairs of files, where the header and image information are separated, and do not have this problem. In this case  is set to 0.</p>
<p>The  function has been overloaded so that it behaves differently when dealing with medical image objects ( and ). The command</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">image</span>(mniLR)</a></code></pre></div>
<p>produces a three-dimensional array of the MNI brain, with the default NIfTI axes, and is displayed on a <span class="math inline">\(10{\times}10\)</span> grid of images (Figure a). The  function for medical image 4 objects is an attempt to balance minimal user input with enough flexibility to customize the display when necessary. For example, single slices may be viewed by using the option  in conjunction with the option  to specify the slice.</p>

<p>The second example of reading in and displaying medical imaging data in the NIfTI format  was also obtained from the NIfTI website (). Successful execution of the commands</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">fname &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="kw">file.path</span>(<span class="st">"nifti"</span>, <span class="st">"mniRL.nii.gz"</span>), <span class="dt">package=</span><span class="st">"oro.nifti"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">(mniRL &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_nifti.html">readNIfTI</a></span>(fname))</a></code></pre></div>
<pre><code>## NIfTI-1 format
##   Type            : niftiAuditTrail
##   Data Type       : 2 (UINT8)
##   Bits per Pixel  : 8
##   Slice Code      : 0 (Unknown)
##   Intent Code     : 0 (None)
##   Qform Code      : 0 (Unknown)
##   Sform Code      : 4 (MNI_152)
##   Dimension       : 91 x 109 x 91
##   Pixel Dimension : 2 x 2 x 2
##   Voxel Units     : mm
##   Time Units      : sec</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">image</span>(mniRL)</a></code></pre></div>
<p>produces a three-dimensional array of the MNI brain that is displayed in a <span class="math inline">\(10{\times}10\)</span> grid of images (Figure b). The two sets of data in Figure  are stored in two different orientations, commonly referred to as the  and  conventions. The neurological convention is where “right is right” and one is essentially looking through the subject. The radiological convention is where “right is left” and one is looking at the subject.</p>

<p>An additional graphical display function has been added for  and  objects that allows a so-called orthographic visualization of the data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="../reference/orthographic-methods.html">orthographic</a></span>(mniRL)</a></code></pre></div>
<p>As seen in Figure  the mid-axial, mid-sagittal and mid-coronal planes are displayed by default. The slices used may be set using , where <span class="math inline">\((I,J,K)\)</span> are appropriate indices, and the crosshairs will provide a spatial reference in each plane relative to the other two.</p>

<p>The NIfTI format contains an implicit generalized spatial transformation from the data co-ordinate system <span class="math inline">\((i,j,k)\)</span> into a real-space “right-handed” co-ordinate system. In this real-space system, the <span class="math inline">\((x,y,z)\)</span> axes are  set such that <span class="math inline">\(x\)</span> increases from left to right, <span class="math inline">\(y\)</span> increases from posterior to anterior and <span class="math inline">\(z\)</span> increases from inferior to superior.</p>
<p>At this point in time the  package cannot apply an arbitrary transform to the imaging data into <span class="math inline">\((x,y,z)\)</span> space – such a transform may require non-integral indices and interpolation steps. The package does accommodate straightforward transformations of imaging data; e.g., setting the <span class="math inline">\(i\)</span>-axis to increase from right to left (the neurological convention). Future versions of  will attempt to address more complicated spatial transformations and provide functionality to display the <span class="math inline">\((x,y,z)\)</span> axes on orthographic plots.</p>

<p>A major improvement in the  package is the fact that standard medical imaging formats are stored in unique classes under the 4 system . Essentially, NIfTI and ANALYZE data are stored as multi-dimensional arrays with extra slots created that capture the format-specific header information; e.g., for a  object</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">slotNames</span>(mniRL)</a></code></pre></div>
<pre><code>##  [1] ".Data"          "trail"          "extensions"    
##  [4] "sizeof_hdr"     "data_type"      "db_name"       
##  [7] "extents"        "session_error"  "regular"       
## [10] "dim_info"       "dim_"           "intent_p1"     
## [13] "intent_p2"      "intent_p3"      "intent_code"   
## [16] "datatype"       "bitpix"         "slice_start"   
## [19] "pixdim"         "vox_offset"     "scl_slope"     
## [22] "scl_inter"      "slice_end"      "slice_code"    
## [25] "xyzt_units"     "cal_max"        "cal_min"       
## [28] "slice_duration" "toffset"        "glmax"         
## [31] "glmin"          "descrip"        "aux_file"      
## [34] "qform_code"     "sform_code"     "quatern_b"     
## [37] "quatern_c"      "quatern_d"      "qoffset_x"     
## [40] "qoffset_y"      "qoffset_z"      "srow_x"        
## [43] "srow_y"         "srow_z"         "intent_name"   
## [46] "magic"          "extender"       "reoriented"</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">c</span>(<span class="kw"><a href="../reference/cal_min-methods.html">cal.min</a></span>(mniRL), <span class="kw"><a href="../reference/cal_max-methods.html">cal.max</a></span>(mniRL))</a></code></pre></div>
<pre><code>## [1]   0 255</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">range</span>(mniRL)</a></code></pre></div>
<pre><code>## [1]   0 255</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">mniRL<span class="op">@</span><span class="st">"datatype"</span></a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="../reference/convert_nifti.html">convert.datatype</a></span>(mniRL<span class="op">@</span><span class="st">"datatype"</span>)</a></code></pre></div>
<pre><code>## [1] "UINT8"</code></pre>
<p>Note, an ANALYZE object has a slightly different set of slots. Slots 4–47 are taken verbatim from the definition of the NIfTI format and are read directly from a file. The slot  is the multidimensional array (since class  inherits from class ) and the slots ,  and  are used for internal bookkeeping. In the code above we have accessed the min/max values of the imaging data using the  and  accessor functions which matches a direct interrogation of the  slot using the  function. Looking at the  slot provides a numeric code that may be converted into a value that indicates the type of byte structure used (in this case an 8-bit or 1-byte unsigned integer).</p>
<p>As introduced in Section~ there are currently only two accessor functions to slots in the NIfTI header ( and ) – all other slots are either ignored or used inside of functions that operate on ANALYZE/NIfTI objects. The NIfTI class also has the ability to read and write extensions that conform to the NIfTI data format. Customized printing and validity-checking functions are available to the user and every attempt has been made to ensure that the information from the multi-dimensional array is in agreement with the header values.</p>
<p>The constructor function  produces valid NIfTI objects, including a consistent header, from an arbitrary array.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">(random.image &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nifti.html">nifti</a></span>(<span class="kw">array</span>(<span class="kw">runif</span>(n<span class="op">*</span>n), <span class="kw">c</span>(n,n,<span class="dv">1</span>))))</a></code></pre></div>
<pre><code>## NIfTI-1 format
##   Type            : niftiAuditTrail
##   Data Type       : 2 (UINT8)
##   Bits per Pixel  : 8
##   Slice Code      : 0 (Unknown)
##   Intent Code     : 0 (None)
##   Qform Code      : 0 (Unknown)
##   Sform Code      : 0 (Unknown)
##   Dimension       : 100 x 100 x 1
##   Pixel Dimension : 1 x 1 x 1
##   Voxel Units     : Unknown
##   Time Units      : Unknown</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">random.image<span class="op">@</span><span class="st">"dim_"</span></a></code></pre></div>
<pre><code>## [1]   3 100 100   1   1   1   1   1</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">dim</span>(random.image)</a></code></pre></div>
<pre><code>## [1] 100 100   1</code></pre>
<p>The function  outputs valid NIfTI class files, which can be opened in other medical imaging software. Files can either be stored as standard  files or compressed with gnuzip (default).</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="../reference/write_nifti.html">writeNIfTI</a></span>(random.image, <span class="st">"random"</span>)</a></code></pre></div>
<pre><code>## Warning in .local(nim, ...): Class is of niftiExtension, extensions
## can be removed using as.nifti</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">list.files</span>(<span class="dt">pattern=</span><span class="st">"random"</span>)</a></code></pre></div>
<pre><code>## [1] "random.nii.gz"</code></pre>

<p>Following on from the 4 implementation of both the NIfTI and ANALYZE data formats, the ability to extend the NIfTI data format header is utilized in the  package. Please use the command</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">options</span>(<span class="dt">niftiAuditTrail=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>to turn on the “audit trail” option in  and then execute the function . With the option enabled extensions are properly handled when reading and writing NIfTI data, users are allowed to add extensions to newly-created NIfTI objects by casting them as  objects and adding  objects to the  slot, and all operations that are performed on a NIfTI object will generate what we call an  that consists of an -based log .</p>
<p>Figure  displays output from the accessor function , the -based audit trail that is stored as a NIfTI header extension.</p>
<p>\begin{sidewaysfigure}  \begin{tabular}{p{22cm}}</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="../reference/audit_trail-methods.html">audit.trail</a></span>(mniLR)</a></code></pre></div>
<pre><code>## &lt;audit-trail xmlns="http://www.dcemri.org/namespaces/audit-trail/1.0"&gt;
##   &lt;created&gt;
##     &lt;workingDirectory&gt;/Users/johnmuschelli/Dropbox/Packages/oro.nifti/vignettes&lt;/workingDirectory&gt;
##     &lt;filename&gt;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/oro.nifti/nifti/mniLR.nii.gz&lt;/filename&gt;
##     &lt;call&gt;readNIfTI(fname = fname)&lt;/call&gt;
##     &lt;system&gt;
##       &lt;r-version&gt;R version 3.5.1 (2018-07-02)&lt;/r-version&gt;
##       &lt;date&gt;Mon Nov 19 16:40:37 2018 EST&lt;/date&gt;
##       &lt;user&gt;johnmuschelli&lt;/user&gt;
##       &lt;package-version&gt;0.9.11&lt;/package-version&gt;
##     &lt;/system&gt;
##   &lt;/created&gt;
##   &lt;event&gt;
##     &lt;type&gt;modification&lt;/type&gt;
##     &lt;call&gt;`cal.max&amp;lt;-`(object = `*tmp*`, value = cmax)&lt;/call&gt;
##     &lt;date&gt;Mon Nov 19 16:40:37 2018 EST&lt;/date&gt;
##     &lt;comment&gt;cal_max &amp;lt;- 255&lt;/comment&gt;
##     &lt;user&gt;johnmuschelli&lt;/user&gt;
##   &lt;/event&gt;
##   &lt;event&gt;
##     &lt;type&gt;modification&lt;/type&gt;
##     &lt;call&gt;`cal.min&amp;lt;-`(object = `*tmp*`, value = cmin)&lt;/call&gt;
##     &lt;date&gt;Mon Nov 19 16:40:37 2018 EST&lt;/date&gt;
##     &lt;comment&gt;cal_min &amp;lt;- 0&lt;/comment&gt;
##     &lt;user&gt;johnmuschelli&lt;/user&gt;
##   &lt;/event&gt;
##   &lt;event&gt;
##     &lt;type&gt;modification&lt;/type&gt;
##     &lt;call&gt;`glmax&amp;lt;-`(object = `*tmp*`, value = cmax)&lt;/call&gt;
##     &lt;date&gt;Mon Nov 19 16:40:37 2018 EST&lt;/date&gt;
##     &lt;comment&gt;glmax &amp;lt;- 255&lt;/comment&gt;
##     &lt;user&gt;johnmuschelli&lt;/user&gt;
##   &lt;/event&gt;
##   &lt;event&gt;
##     &lt;type&gt;modification&lt;/type&gt;
##     &lt;call&gt;`glmin&amp;lt;-`(object = `*tmp*`, value = cmin)&lt;/call&gt;
##     &lt;date&gt;Mon Nov 19 16:40:37 2018 EST&lt;/date&gt;
##     &lt;comment&gt;glmin &amp;lt;- 0&lt;/comment&gt;
##     &lt;user&gt;johnmuschelli&lt;/user&gt;
##   &lt;/event&gt;
## &lt;/audit-trail&gt;</code></pre>
\end{tabular}

<p>\end{sidewaysfigure}</p>
<p>Each log entry contains information not only about the function applied to the NIfTI object, but also various system-level information; e.g., version of , user name, date, time, etc. When writing NIfTI-class objects to disk, the -based NIfTI extension is converted into plain text and saved using  to denote plain ASCII text. The user may control the tracking of data manipulation via the audit trail using the global option .</p>

<p>Basic visualization of  and  class images can be achieved with any visualization for arrays in . For example, the  package provides functions  and  for visualization . Please note that functions in  expect grey-scale values in the range <span class="math inline">\([0,1]\)</span>, hence the display of  data may be performed using</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">mniLR.range &lt;-<span class="st"> </span><span class="kw">range</span>(mniLR)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">EBImage<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/EBImage/topics/display">display</a></span>((mniLR <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(mniLR)) <span class="op">/</span><span class="st"> </span><span class="kw">diff</span>(mniLR.range))</a></code></pre></div>
Interactive visualization of multi-dimensional arrays, stored in NIfTI or ANALYZE format, is however best performed outside of  at this point in time. Popular viewers, especially for neuroimaging data, include

<p>The  package provides basic interactive visualization of ANALYZE/NIfTI data using a / interface .</p>


<p>This is an example of reading in, and displaying, a four-dimensional medical imaging data set in NIfTI format  obtained from the  evaluation and example data suite (). Successful execution of the commands</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">filtered.func.data &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw">system.file</span>(<span class="kw">file.path</span>(<span class="st">"nifti"</span>, <span class="st">"filtered_func_data.nii.gz"</span>), </a>
<a class="sourceLine" id="cb39-3" data-line-number="3">              <span class="dt">package=</span><span class="st">"oro.nifti"</span>)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">(ffd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_nifti.html">readNIfTI</a></span>(filtered.func.data))</a></code></pre></div>
<pre><code>## NIfTI-1 format
##   Type            : niftiAuditTrail
##   Data Type       : 4 (INT16)
##   Bits per Pixel  : 16
##   Slice Code      : 0 (Unknown)
##   Intent Code     : 0 (None)
##   Qform Code      : 0 (Unknown)
##   Sform Code      : 0 (Unknown)
##   Dimension       : 64 x 64 x 21 x 64
##   Pixel Dimension : 1 x 1 x 1 x 1
##   Voxel Units     : Unknown
##   Time Units      : Unknown</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">image</span>(ffd, <span class="dt">zlim=</span><span class="kw">range</span>(ffd)<span class="op">*</span><span class="fl">0.95</span>)</a></code></pre></div>
<p>produces a four-dimensional (4D) array of imaging data that may be displayed in a <span class="math inline">\(5{\times}5\)</span> grid of images (Figure a). The first three dimensions are spatial locations of the voxel (volume element) and the fourth dimension is time for this functional MRI (fMRI) acquisition. As seen from the summary of object, there are 21 axial slices of fairly coarse resolution (<span class="math inline">\(4{\times}4{\times}6\;\text{mm}\)</span>) and reasonable temporal resolution (<span class="math inline">\(3\;\text{s}\)</span>). Figure b depicts the orthographic display of the  using the axial plane containing the left-and-right thalamus to approximately center the crosshair vertically.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw"><a href="../reference/orthographic-methods.html">orthographic</a></span>(ffd, <span class="dt">xyz=</span><span class="kw">c</span>(<span class="dv">34</span>,<span class="dv">29</span>,<span class="dv">10</span>), <span class="dt">zlim=</span><span class="kw">range</span>(ffd)<span class="op">*</span><span class="fl">0.9</span>)</a></code></pre></div>

<p>The  programming environment provides a wide variety of statistical methodology for the quantitative analysis of medical imaging data. For example, functional MRI (fMRI) data are typically analyzed by applying a multiple linear regression model, commonly referred to in the literature as a general linear model (GLM), that utilizes the stimulus experiment to construct the design matrix. Estimation of the regression coefficients in the GLM produces a statistical image; e.g., <span class="math inline">\(Z\)</span>-statistics for a voxel-wise hypothesis test on activation in fMRI experiments .</p>

<p>The 4D volume of imaging data in  was acquired in an experiment with a repetition time <span class="math inline">\(\text{TR}=3\;\text{s}\)</span>, using both visual and auditory stimuli. The visual stimulus was applied using an on/off pattern for a duration of 60 seconds and the auditory stimulus was applied using an on/off pattern for a duration of 90 seconds. A parametric haemodynamic response function (HRF), with mean <span class="math inline">\(\mu=6\)</span> and standard deviation <span class="math inline">\(\sigma=3\)</span>, is utilized here which is similar to the default values in  . We construct the experimental design and HRF in seconds, perform the convolution and then downsample by a factor of three in order to obtain columns of the design matrix that match the acquisition of the MRI data.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">visual &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">each=</span><span class="dv">30</span>, <span class="dt">times=</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">auditory &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">each=</span><span class="dv">45</span>, <span class="dt">times=</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">hrf &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">dgamma</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>, <span class="dv">4</span>, <span class="dt">scale=</span><span class="fl">1.5</span>))</a>
<a class="sourceLine" id="cb43-4" data-line-number="4">hrf0 &lt;-<span class="st"> </span><span class="kw">c</span>(hrf, <span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">length</span>(visual)<span class="op">-</span><span class="kw">length</span>(hrf)))</a>
<a class="sourceLine" id="cb43-5" data-line-number="5">visual.hrf &lt;-<span class="st"> </span><span class="kw">convolve</span>(hrf0, visual)</a>
<a class="sourceLine" id="cb43-6" data-line-number="6">hrf0 &lt;-<span class="st"> </span><span class="kw">c</span>(hrf, <span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">length</span>(auditory)<span class="op">-</span><span class="kw">length</span>(hrf)))</a>
<a class="sourceLine" id="cb43-7" data-line-number="7">auditory.hrf &lt;-<span class="st"> </span><span class="kw">convolve</span>(hrf0, auditory)</a>
<a class="sourceLine" id="cb43-8" data-line-number="8">index &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">540</span>, <span class="dt">by=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb43-9" data-line-number="9">visual.hrf &lt;-<span class="st"> </span>visual.hrf[index]</a>
<a class="sourceLine" id="cb43-10" data-line-number="10">auditory.hrf &lt;-<span class="st"> </span>auditory.hrf[index]</a></code></pre></div>
<p>Figure  depicts the visual and auditory stimuli, convolved with the HRF, in the order of acquisition. The design matrix is then used in a voxel-wise GLM, where the  function in  estimates the parameters in the linear regression. At each voxel <span class="math inline">\(t\)</span>-statistics and their associated <span class="math inline">\(p\)</span>-values are computed for the hypothesis test of no effect for each individual stimulus, along with an <span class="math inline">\(F\)</span>-statistic for the hypothesis test of no effect of any stimuli using the  function.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="co">##reduced length due to R package storage limitations</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2">visual.hrf&lt;-visual.hrf[<span class="dv">1</span><span class="op">:</span><span class="dv">64</span>]</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">auditory.hrf&lt;-auditory.hrf[<span class="dv">1</span><span class="op">:</span><span class="dv">64</span>]</a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="co">## background threshold: 10% max intensity</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5">voxel.lsfit &lt;-<span class="st"> </span><span class="cf">function</span>(x, thresh) { <span class="co"># general linear model</span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6">  <span class="co">## check against background threshold</span></a>
<a class="sourceLine" id="cb44-7" data-line-number="7">  <span class="cf">if</span> (<span class="kw">max</span>(x) <span class="op">&lt;</span><span class="st"> </span>thresh) {</a>
<a class="sourceLine" id="cb44-8" data-line-number="8">    <span class="kw">return</span>(<span class="kw">rep</span>(<span class="ot">NA</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb44-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb44-10" data-line-number="10">  <span class="co">## glm</span></a>
<a class="sourceLine" id="cb44-11" data-line-number="11">  output &lt;-<span class="st"> </span><span class="kw">lsfit</span>(<span class="kw">cbind</span>(visual.hrf, auditory.hrf), x)</a>
<a class="sourceLine" id="cb44-12" data-line-number="12">  <span class="co">## extract t-statistic, p-values</span></a>
<a class="sourceLine" id="cb44-13" data-line-number="13">  output.t &lt;-<span class="st"> </span><span class="kw">ls.print</span>(output, <span class="dt">print.it=</span><span class="ot">FALSE</span>)<span class="op">$</span>coef.table[[<span class="dv">1</span>]][<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>,<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb44-14" data-line-number="14">  output.f &lt;-<span class="st"> </span><span class="kw">ls.print</span>(output, <span class="dt">print.it=</span><span class="ot">FALSE</span>)<span class="op">$</span>summary[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb44-15" data-line-number="15">  <span class="kw">c</span>(output.t, <span class="kw">as.numeric</span>(output.f))</a>
<a class="sourceLine" id="cb44-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb44-17" data-line-number="17"><span class="co">## apply local glm to each voxel</span></a>
<a class="sourceLine" id="cb44-18" data-line-number="18">ffd.glm &lt;-<span class="st"> </span><span class="kw">apply</span>(ffd, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, voxel.lsfit, <span class="dt">thresh=</span><span class="fl">0.1</span> <span class="op">*</span><span class="st"> </span><span class="kw">max</span>(ffd))</a></code></pre></div>

<p>Given the multidimensional array of output from the GLM fitting procedure, the <span class="math inline">\(t\)</span>-statistics are separated and converted into <span class="math inline">\(Z\)</span>-statistics to follow the convention used in . For the purposes of this example we have not applied any multiple comparisons correction procedure and, instead, use a relatively large threshold of <span class="math inline">\(Z&gt;5\)</span> for visualization.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">dof &lt;-<span class="st"> </span><span class="kw"><a href="../reference/miscellaneous.html">ntim</a></span>(ffd) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2">Z.visual &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nifti.html">nifti</a></span>(<span class="kw">qnorm</span>(<span class="kw">pt</span>(ffd.glm[<span class="dv">1</span>,,,], dof, <span class="dt">log.p=</span><span class="ot">TRUE</span>), <span class="dt">log.p=</span><span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb45-3" data-line-number="3">                  <span class="dt">datatype=</span><span class="dv">16</span>)</a>
<a class="sourceLine" id="cb45-4" data-line-number="4">Z.auditory &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nifti.html">nifti</a></span>(<span class="kw">qnorm</span>(<span class="kw">pt</span>(ffd.glm[<span class="dv">2</span>,,,], dof, <span class="dt">log.p=</span><span class="ot">TRUE</span>), <span class="dt">log.p=</span><span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb45-5" data-line-number="5">                    <span class="dt">datatype=</span><span class="dv">16</span>)</a></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">yrange &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="kw">max</span>(Z.visual, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="kw"><a href="../reference/overlay-methods.html">overlay</a></span>(ffd, <span class="kw">ifelse</span>(Z.visual <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, Z.visual, <span class="ot">NA</span>), </a>
<a class="sourceLine" id="cb46-3" data-line-number="3">        <span class="dt">zlim.x=</span><span class="kw">range</span>(ffd)<span class="op">*</span><span class="fl">0.95</span>, <span class="dt">zlim.y=</span>yrange)</a></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">yrange &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="kw">max</span>(Z.auditory, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw"><a href="../reference/overlay-methods.html">overlay</a></span>(ffd, <span class="kw">ifelse</span>(Z.auditory <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, Z.auditory, <span class="ot">NA</span>), </a>
<a class="sourceLine" id="cb47-3" data-line-number="3">        <span class="dt">zlim.x=</span><span class="kw">range</span>(ffd)<span class="op">*</span><span class="fl">0.95</span>, <span class="dt">zlim.y=</span>yrange)</a></code></pre></div>
<p>Statistical images in neuroimaging are commonly displayed as an overlay on top of a reference image (one of the dynamic acquisitions) in order to provide anatomical context. The  command in  allows one to display the statistical image of voxel-wise activations overlayed on one of the original EPI (echo planar imaging) volumes acquired in the fMRI experiment. The 3D array of <span class="math inline">\(Z\)</span>-statistics for the visual and auditory tasks are overlayed on the original data for “anatomical” reference in Figure . The <span class="math inline">\(Z\)</span>-statistics that exceed the threshold appear to match know neuroanatomy, where the visual cortex in the occipital lobe shows activation under the visual stimulus (Figure a) and the primary auditory cortex in the temporal lobe shows activation under the auditory stimulus (Figure b).</p>

<p>Medical image analysis depends on the efficient manipulation and conversion of DICOM data. The  package has been developed to provide the user with a set of functions that mask as many of the background details as possible while still providing flexible and robust performance.</p>
<p>The future of medical image analysis in  will benefit from a unified view of the imaging data standards: DICOM, NIfTI, ANALYZE, AFNI, MINC, etc. The existence of a single package for handling imaging data formats would facilitate interoperability between the ever increasing number of  packages devoted to medical image analysis. We do not assume that the data structures in  are best-suited for this purpose and we welcome an open discussion around how best to provide this standardization to the end user.</p>

<p>The authors would like to thank the National Biomedical Imaging Archive (NBIA), the National Cancer Institute (NCI), the National Institute of Health (NIH) and all institutions that have contributed medical imaging data to the public domain. The authors would also like to thank K. Tabelow for providing functionality around the AFNI data format. VS is supported by the German Research Council (DFG SCHM 2747/1-1).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Brandon Whitcher, Volker Schmid, Andrew Thornton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
